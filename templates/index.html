<!DOCTYPE html>
<html>
<head>
    <title>Local Farms</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
    /* Set a more modern font family */
    html * {
        font-family: 'Times New Roman', Times, serif; /* Classic and formal font style */
        font-weight: normal;
    }

    /* Refine the body layout */
    body {
        display: flex;
        justify-content: space-between;
        height: 100vh;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4; /* Light grey background for less strain on eyes */
    }

    /* Style sections for a cleaner and more modern look */
    .section {
        border: 1px solid #ccc; /* Subtle border */
        background-color: white; /* Brighter background for better contrast */
        padding: 20px;
        overflow: auto;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    }

    .leftSection {
        position: fixed; /* Changed from absolute to fixed to remain visible */
        left: 0; /* Align to the left edge */
        width: 25%; /* Consistent width */
        padding: 20px;
        height: 100%; /* Full height */
        background-color: rgb(222, 222, 222);
        text-align: left;
    }
    .rightSection {
        position: fixed; /* Changed from absolute to fixed to remain visible */
        right: 0; /* Align to the right edge */
        width: 25%; /* Consistent width minus padding */
        padding: 20px;
        height: 100%; /* Full height */
        background-color: rgb(222, 222, 222);
        text-align: center;
    }

    .middleSection {
        position: absolute;
        left: 27%; /* Start from the end of the left section */
        right: 27%; /* End before the right section starts */
        height: 100%; /* Full height */
        display: flex;
        align-items: center; /* Center content vertically */
        justify-content: center; /* Center content horizontally */
    }

    #map {
        height: 100%; /* Adjusted height */
        width: 100%; /* Full width of the middle section */
        border: 1px solid #ddd; /* Subtle border around the map */
        border-radius: 8px; /* Rounded corners for the map */
    }
</style>

</head>
<body>
    <div class="leftSection">
        <h1>Select a Farm to Display</h1>
        <select id="farmSelect" onchange="zoomToFarm()">
            <option value="">--Select a Farm--</option>
            {% for farm in farms %}
            <option value="{{ farm['id'] }}" data-lat="{{ farm.latitude }}" data-lng="{{ farm.longitude }}" data-description="{{ farm.description }}">
            {{ farm['name'] }}
            </option>
            {% endfor %}
        </select>

        <h1>Filter</h1>
        <form id="filterForm">
            <ul>
                <li><input type="checkbox" name="filter" value="animal_conditions"> Good Animal Conditions</li>
                <li><input type="checkbox" name="filter" value="farmer_conditions"> Good Farmer Conditions</li>
                <li><input type="checkbox" name="filter" value="climate_neutral"> Climate Neutral</li>
                <li><input type="checkbox" name="filter" value="no_pesticides"> No Pesticides</li>
            </ul>
            <button type="button" onclick="applyFilter()">Apply Filter</button>
        </form>
    </div>

    <div class="middleSection">
    <div id="map"></div>
    <script>
        var map = L.map('map', {
            minZoom: 3,  // Minimum zoom level
            maxZoom: 18, // Maximum zoom level
            maxBounds: [  // Define the geographical boundaries to restrict the map panning
                [-100, -160],  // SouthWest corner of the boundary
                [150, 180]    // NorthEast corner of the boundary
            ],
            maxBoundsViscosity: 1.0  // Makes the bounds fully rigid
        }).setView([63, 15], 5.4);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
            noWrap: true
        }).addTo(map);

        var markers = {};

        {% for farm in farms %}
        markers['{{ farm['id'] }}'] = add_marker({{ farm.latitude }}, {{ farm.longitude }}, "{{ farm.name }}", "{{ farm.description }}");
        {% endfor %}

        function add_marker(latitude, longitude, name, description) {
            return L.marker([latitude, longitude]).addTo(map).bindPopup("<b>" + name);
        }

        function zoomToFarm() {
            var select = document.getElementById('farmSelect');
            var selectedOption = select.options[select.selectedIndex];
            var lat = selectedOption.getAttribute('data-lat');
            var lng = selectedOption.getAttribute('data-lng');
            if(lat && lng) {
                map.setView([lat, lng], 12);
                markers[selectedOption.value].openPopup();
                updateInfo(selectedOption.text, selectedOption.getAttribute('data-description'));
            }
        }
        function updateInfo(name, description) {
            document.getElementById('farmName').textContent = name;
            document.getElementById('farmDescription').textContent = description;
        }
    </script>
</div>
    <div class="rightSection">
        <h1 id="farmName">Farm Name</h1>
        <div class="farmInfo">
            <p id="farmDescription">Information and Metrics</p>
        </div>
    </div>
</body>
</html>
